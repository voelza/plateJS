(function(i,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(i=typeof globalThis<"u"?globalThis:i||self,v(i.PlateJS={}))})(this,function(i){"use strict";function v(e){const n={};return{dom:E(y(e,n),e),refs:n}}function E(e,n){const c={};return Object.entries(e).forEach(([s,t])=>c[s]=t),c.__self=n,c}function y(e,n){const c={};for(let s=0;s<e.children.length;s++){const t=e.children[s],o=[t.tagName.toLowerCase()],r=t.getAttribute("ref");r&&o.push(r);for(const a of o){let f=c[a]instanceof Array;!f&&c[a]&&(f=!0,c[a]=[c[a]]);let d;t.children.length===0?d=t:d=E(y(t,n),t),f?c[a].push(d):c[a]=d,r&&(n[r]=c[a])}}return c}let h;function T(e){return(n=void 0)=>n?e:(h&&e.observers.add(h),e.value)}function w(e){const n={value:e,observers:new Set};return[T(n),c=>{n.value=c,n.observers.forEach(s=>s.update())}]}function A(e){const n={value:void 0,observers:new Set};return u(()=>{n.value=e();for(const c of n.observers)c.update()}),T(n)}function u(e){const n={update:()=>{h=n,e(),h=void 0}};return n.update(),n}function M(e,n){u(()=>{const c=n();l(e,s=>s.textContent=c)})}function x(e,n,c){u(()=>{const s=c();let t;typeof s=="object"?t=Object.entries(s).map(([o,r])=>`${o}:${r}`).join(";"):t=s,typeof t=="boolean"?Boolean(t)?l(e,o=>m(o).setAttribute(n,"")):l(e,o=>m(o).removeAttribute(n)):l(e,o=>m(o).setAttribute(n,t))})}function I(e,n){const c=new Map;l(e,t=>{const o=new Text;t.before(o),c.set(t,o)});let s;u(()=>{const t=n();try{if(t===s)return;l(e,o=>{if(t){const r=c.get(o);r==null||r.before(o)}else o.remove()})}catch(o){console.error(o)}finally{s=t}})}function S(e,n,c){const s=[];l(e,o=>{const r=new Text;o.before(r),o.remove(),s.push({marker:r,template:o.cloneNode(!0),elements:[]})});let t;u(()=>{const o=n();try{if(o===t)return;for(const r of s){let a=o.length;t!==void 0&&t.length>a&&(a=t.length);for(let f=0;f<a;f++){const d=o[f],k=t?t[f]:null;if(d==k)continue;const b=r.elements[f];if(d===void 0)b.remove(),r.elements.splice(f,1);else if(k===void 0||!b){const H=o[f],g=r.template.cloneNode(!0);r.marker.before(g),r.elements.push(g),requestAnimationFrame(()=>c({element:g,item:H,index:f}))}else c({element:b,item:d,index:f})}}}catch(r){console.error(r)}finally{t=o.map(r=>r instanceof Object?structuredClone(r):r)}})}function L(e){u(e)}function O(e,...n){const c=u(e);for(const s of n)s(!0).observers.add(c)}function p(e,n,c){l(e,s=>s.addEventListener(n,c))}function j(e,n){p(e,"click",n)}function D(e,n,c){l(e,s=>{p(s,"input",t=>{const o=t;let r;if(o.target instanceof HTMLInputElement){const a=o.target.value;switch(r=a,o.target.type){case"number":case"range":r=parseFloat(a);break;case"date":case"datetime-local":r=new Date(a);break;case"checkbox":case"radio":r=o.target.checked;break}}else s instanceof HTMLTextAreaElement?r=s.value:o.target instanceof HTMLSelectElement&&(r=o.target.options[o.target.selectedIndex].text);c(r)})}),u(()=>{const s=n();l(e,t=>{if(t instanceof HTMLInputElement)t.type==="checkbox"||t.type==="radio"?t.checked=s:t.type==="date"&&s instanceof Date?t.value=s.toISOString().split("T")[0]:t.value=s;else if(t instanceof HTMLTextAreaElement)t.value=s;else if(t instanceof HTMLSelectElement){let o=0;for(let r=0;r<t.options.length;r++)if(t.options[r].text===s){o=r;break}t.selectedIndex=o}})})}function m(e){return e instanceof Element?e:e.__self}function l(e,n){let c;e instanceof Array?c=[...e]:c=[e],c.forEach(s=>n(m(s)))}i.attr=x,i.click=j,i.computed=A,i.create=v,i.event=p,i.forEach=S,i.model=D,i.renderIf=I,i.state=w,i.text=M,i.watch=L,i.watchDetached=O,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
