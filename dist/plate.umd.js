(function(i,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(i=typeof globalThis<"u"?globalThis:i||self,v(i.PlateJS={}))})(this,function(i){"use strict";function v(e){const n={};return{dom:E(y(e,n),e),refs:n}}function E(e,n){const r={};return Object.entries(e).forEach(([s,t])=>r[s]=t),r.__self=n,r}function y(e,n){const r={};for(let s=0;s<e.children.length;s++){const t=e.children[s],o=[t.tagName.toLowerCase()],c=t.getAttribute("ref");c&&o.push(c);for(const a of o){let f=r[a]instanceof Array;!f&&r[a]&&(f=!0,r[a]=[r[a]]);let d;t.children.length===0?d=t:d=E(y(t,n),t),f?r[a].push(d):r[a]=d,c&&(n[c]=r[a])}}return r}let h;function T(e){return(n=void 0)=>n?e:(h&&e.observers.add(h),e.value)}function w(e){const n={value:e,observers:new Set};return[T(n),r=>{n.value=r,n.observers.forEach(s=>s.update())}]}function A(e){const n={value:void 0,observers:new Set};return l(()=>{n.value=e();for(const r of n.observers)r.update()}),T(n)}function M(e){e(!0).observers.forEach(r=>r.update())}function l(e){const n={update:()=>{h=n,e(),h=void 0}};return n.update(),n}function I(e,n){l(()=>{const r=n();u(e,s=>s.textContent=r)})}function S(e,n,r){l(()=>{const s=r();let t;typeof s=="object"?t=Object.entries(s).map(([o,c])=>`${o}:${c}`).join(";"):t=s,typeof t=="boolean"?Boolean(t)?u(e,o=>m(o).setAttribute(n,"")):u(e,o=>m(o).removeAttribute(n)):u(e,o=>m(o).setAttribute(n,t))})}function x(e,n){const r=new Map;u(e,t=>{const o=new Text;t.before(o),r.set(t,o)});let s;l(()=>{const t=n();try{if(t===s)return;u(e,o=>{if(t){const c=r.get(o);c==null||c.before(o)}else o.remove()})}catch(o){console.error(o)}finally{s=t}})}function L(e,n,r){const s=[];u(e,o=>{const c=new Text;o.before(c),o.remove(),s.push({marker:c,template:o.cloneNode(!0),elements:[]})});let t;l(()=>{const o=n();try{if(o===t)return;for(const c of s){let a=o.length;t!==void 0&&t.length>a&&(a=t.length);for(let f=0;f<a;f++){const d=o[f],k=t?t[f]:null;if(d==k)continue;const p=c.elements[f];if(d===void 0)p.remove(),c.elements.splice(f,1);else if(k===void 0||!p){const _=o[f],g=c.template.cloneNode(!0);c.marker.before(g),c.elements.push(g),requestAnimationFrame(()=>r({element:g,item:_,index:f}))}else r({element:p,item:d,index:f})}}}catch(c){console.error(c)}finally{t=o.map(c=>c instanceof Object?structuredClone(c):c)}})}function O(e){l(e)}function j(e,...n){const r=l(e);for(const s of n)s(!0).observers.add(r)}function b(e,n,r){u(e,s=>s.addEventListener(n,r))}function D(e,n){b(e,"click",n)}function H(e,n,r){u(e,s=>{b(s,"input",t=>{const o=t;let c;if(o.target instanceof HTMLInputElement){const a=o.target.value;switch(c=a,o.target.type){case"number":case"range":c=parseFloat(a);break;case"date":case"datetime-local":c=new Date(a);break;case"checkbox":case"radio":c=o.target.checked;break}}else s instanceof HTMLTextAreaElement?c=s.value:o.target instanceof HTMLSelectElement&&(c=o.target.options[o.target.selectedIndex].text);r(c)})}),l(()=>{const s=n();u(e,t=>{if(t instanceof HTMLInputElement)t.type==="checkbox"||t.type==="radio"?t.checked=s:t.type==="date"&&s instanceof Date?t.value=s.toISOString().split("T")[0]:t.value=s;else if(t instanceof HTMLTextAreaElement)t.value=s;else if(t instanceof HTMLSelectElement){let o=0;for(let c=0;c<t.options.length;c++)if(t.options[c].text===s){o=c;break}t.selectedIndex=o}})})}function m(e){return e instanceof Element?e:e.__self}function u(e,n){let r;e instanceof Array?r=[...e]:r=[e],r.forEach(s=>n(m(s)))}i.attr=S,i.click=D,i.computed=A,i.create=v,i.event=b,i.forEach=L,i.model=H,i.notify=M,i.renderIf=x,i.state=w,i.text=I,i.watch=O,i.watchDetached=j,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
